<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IW Tech Test</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
        <header class="masthead mb-auto">
            <div class="inner">
                <h3 class="masthead-brand">Infinity Works Tech Test</h3>
            </div>
        </header>
        <main role="main" class="inner cover">
            <h1 class="cover-heading">Food Agency Data Summarizer.</h1>
            <p class="lead">This summarizer will take all the data from a specific authority, and show you how the food
                hygiene ratings are distributed.</p>
            <p><label> Select an Authority:
                <select id="authorities-dropdown" onchange="loadAuthority(this.value)">
                    <!-- auto filled in -->
                </select>
            </label></p>
            <table class="table table-dark table-striped">
                <thead>
                <tr>
                    <th>Rating</th>
                    <th>Percentage</th>
                </tr>
                </thead>
                <tbody id="ratings-table">
                <!-- auto filled in -->
                </tbody>
            </table>
        </main>
        <footer class="mastfoot mt-auto">
            <div class="inner">
                <p><a href="https://www.infinityworks.com">Infinity Works</a> - Full Stack Tech Test <a
                        href="https://www.infinityworks.com/insights/hiring-our-jugglers/" class="btn btn-secondary">Find
                    out more?</a></p>
            </div>
        </footer>
    </div>
    <script>
        fetch('/api')
            .then(response => response.json())
            .then(authorities => {
                    const authoritiesDropdown = document.getElementById('authorities-dropdown')
                    authorities.forEach(authority => {
                        authoritiesDropdown.insertAdjacentHTML('beforeend', '<option value="' + authority.id + '">' + authority.name + '</option>')
                    })
                    loadAuthority(authoritiesDropdown.value)
                }
            )

        async function loadAuthority(authorityId) {
            const ratingsTable = document.getElementById('ratings-table')
            const response = await fetch('/api/' + authorityId)
            const ratings = await response.json()
            ratingsTable.innerHTML = ''
            ratings.forEach(rating => {
                ratingsTable.insertAdjacentHTML('beforeend', '<tr><td>' + rating.name + '</td><td>' + rating.value.toFixed(1) + '%</td></tr>')
            })
        }
        </script>
    </body>
</html>
